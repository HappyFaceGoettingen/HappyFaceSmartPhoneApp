angular.module("hf.BackgroundRefresh",[]).factory("FacBackgroundRefresh",["FacInstances","FacWebservice","FacUIVariables","$state",function(e,t,n,r){function i(){var i=window.plugins.backgroundFetch;var s=function(){if(navigator.connection.type!=Connection.NONE&&e.getLastActiveInstance().length!=0){var s=e.getLastActiveInstance().categories.category;e.lightweightRefresh().then(function(){var t=[];var r;for(r=0;r<s.length;++r){if(s[r].name==e.getLastActiveInstance().categories.category[r].name&&s[r].status!=e.getLastActiveInstance().categories.category[r].status){var i="";if(e.getLastActiveInstance().categories.category[r].status==1){i="'Ok'"}else if(e.getLastActiveInstance().categories.category[r].status==.5){i="'Warning'"}else if(e.getLastActiveInstance().categories.category[r].status==0){i="'Critical'"}t.push({title:e.getLastActiveInstance().categories.category[r].title,status:i})}}var o="";for(r=0;r<t.length;++r){o+=r>0?"\n":""+t[r].status+" is now the status of "+t[r].title+"."}if(t.length!=0){window.plugin.notification.local.add({message:o})}else if(n.getExtendedNotifications()){window.plugin.notification.local.add({message:"Just fetched! No changes."})}},function(){});if(r.is("sidemenu.details")){t.setTableContent()}}i.finish()};i.configure(s)}return{initializeBackgroundFetch:function(){i()}}}])